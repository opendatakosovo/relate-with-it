{% extends "layout.html" %}

{% block script %}
    <script src="http://d3js.org/d3.v3.min.js"></script>
{% endblock %}

{% block style %}
 <style type="text/css">
    #sliderDiv {
        margin: 10px;
        margin-top: 30px;
        height: 15px;
        width: 350px;
    }
    
    #mainSvg {       
       
    }

    .svgLane{
        display: inline;
        width: 350px;
        height: 550px;
        overflow: none;
        padding: 10px;
        float: left;

    }
    
    text {
        fill: orange;
        text-anchor: left;
        font-size: 12px;
        font-family: sans-serif, Helvetica, Arial;
        font-weight: bold;
    }
    
    .iconPlain {
        fill: white;
        opacity: 0.01;
    }
    
    .iconSelected {
        fill: orange;
        opacity: 1;
    }
    
    rect {
        fill: #555555;
    }
    .pictogram *{
        fill:orange;
        stroke:orange;
    }
    </style>
{% endblock %}
    
{% block body %}

    <script>

    //specify the number of columns and rows for pictogram layout
    //numCols * numRows = max amount of pictograms
    var numCols = 3;
    var numRows = 15;

    //padding for the grid
    var xPadding = 10;
    var yPadding = 15;

    //horizontal and vertical spacing between the icons
    var hBuffer = 9;
    var wBuffer = 8;


    //generate a d3 range for the total number of required elements
    var myIndex = d3.range(numCols * numRows);
    

    //create main 'Lanes' element
    var svgDoc = d3.select("body").append("svg")
        .attr("id","mainSvg")
        .attr("class","svgLane")
        .attr("viewBox", "0 0 100 150");

    var svgDoc1 = d3.select("body").append("svg")
        .attr("id","mainSvg1")
        .attr("class","svgLane")
        .attr("viewBox", "0 0 100 150");

    var svgDoc2 = d3.select("body").append("svg")
        .attr("id","mainSvg2")
        .attr("class","svgLane")
        .attr("viewBox", "0 0 100 150");

    //background rectangle
    svgDoc.append("rect").attr("width", 100).attr("height", 150);
    svgDoc1.append("rect").attr("width", 100).attr("height", 150);
    svgDoc2.append("rect").attr("width", 100).attr("height", 150);    

    //define an icon store it in svg <defs> elements as a reusable component - this geometry can be generated from Inkscape, Illustrator or similar
    svgDoc.append("defs")
        .append("g")
        .attr("id", "iconCustom")
        .append("path")
        .attr("d", "M3.5,2H2.7C3,1.8,3.3,1.5,3.3,1.1c0-0.6-0.4-1-1-1c-0.6,0-1,0.4-1,1c0,0.4,0.2,0.7,0.6,0.9H1.1C0.7,2,0.4,2.3,0.4,2.6v1.9c0,0.3,0.3,0.6,0.6,0.6h0.2c0,0,0,0.1,0,0.1v1.9c0,0.3,0.2,0.6,0.3,0.6h1.3c0.2,0,0.3-0.3,0.3-0.6V5.3c0,0,0-0.1,0-0.1h0.2c0.3,0,0.6-0.3,0.6-0.6V2.6C4.1,2.3,3.8,2,3.5,2z");

    //svgDoc.append("img")    

    

    /* svg image */
    /*
    d3.xml("static/img/rent1.svg", "image/svg+xml", function(xml) {
        var img = document.importNode(xml.documentElement, true);
        d3.select("body")[0][0].appendChild(img);
        d3.select("#rentImg")
            .attr("class","pictogram")
            .attr("width","7px")
            .attr("height","10px");            
    })
    */

    /*
    http://edutechwiki.unige.ch/en/Using_SVG_with_HTML5_tutorial#Importing_with_original_size_and_create_a_viewBox
     */

    var img1 = d3.select("#mainSvg2 rect")/*.append("svg")
        .attr("viewBox", "0 0 100 150")*/
        
        .append("image")
        .attr("id", "rentImg")
        .attr("x", "0")
        .attr("y", "0")
        .attr("width", "7")
        .attr("height", "10")
        .attr("xlink:href", "static/img/1.png");

    var img2 = d3.select("#mainSvg1 rect")        
        .append("image")
        .attr("id", "stadiumImg")
        .attr("x", "0")
        .attr("y", "0")
        .attr("width", "7")
        .attr("height", "10")
        .attr("xlink:href", "static/img/2.png");    
    




    //text element to display number of icons highlighted
    svgDoc.append("text")
        .attr("id", "txtValue")
        .attr("x", xPadding * 4.2)
        .attr("y", yPadding)
        .attr("dy", -3)
        .text("0");
    
    svgDoc
        .append("use")
        .attr("x", xPadding * 3.5)
        .attr("y", yPadding/4)
        .attr("dy", -3)
        .attr("dx", 5)
        .attr("xlink:href", "#rentImg")
        .attr('cursor',"hand" )
        .attr('cursor',"pointer" )
        .on("click",function (d,i) {   

            var randImg = ["#stadiumImg","#iconCustom","#rentImg"][rand(3)-1]
        
            d3.select(this).attr("xlink:href", randImg)
            addLane(laneName1, 0, 0, randImg);
            showPictograms(rand(45), laneName1);
            
        });

    //create group element and create an svg <use> element for each icon

    function addImage (pathToImage) {
        
        // make it working with png, jpeg and svg        

    }

    function addLane(laneName, xShift, yShift, imgUri) {

        var exist = d3.select("#"+laneName);
        var temp = exist;
        
        if(exist){
            exist.remove();
              
        } 
        
        svgDoc.append("g")
            .attr("id", laneName)
            .selectAll(laneName + " use")
            .data(myIndex)
            .enter()
            .append("use")
            .attr("xlink:href", function(d, i) {

                if(imgUri != undefined){
                    //remove the previous
                    
                    return imgUri;  
                } 

                if (laneName == "pictoLayer1") return "#rentImg";
                return "#iconCustom";
            })
            .attr("id", function(d) {
                return laneName + "icon" + d;
            })
            .attr("x", function(d) {
                var remainder = d % numCols; //calculates the x position (column number) using modulus
                return xPadding + (remainder * wBuffer) + xShift; //apply the buffer and return value
            })
            .attr("y", function(d) {
                var whole = Math.floor(d / numCols) //calculates the y position (row number)
                return yPadding + (whole * hBuffer); //apply the buffer and return the value
            })
            .classed("iconPlain", true);

    }

    function showPictograms(noSelected, laneName) {

        var amountOfDisplayedPictograms = noSelected;

        d3.select("#txtValue").text(amountOfDisplayedPictograms);

        //array indexes: 0 to length -1
        var total = d3.selectAll("#" + laneName + " use")[0].length - 1;


        d3.selectAll("#" + laneName + " use").attr("class", function(d, i) {

            if ((total - d) < amountOfDisplayedPictograms) {
                return "iconSelected";
            } else {
                return "iconPlain";
            }
        });
    }


    var laneName1 = "pictoLayer";
    var laneName2 = "pictoLayer1";
    var laneName3 = "pictoLayer2";

    addLane(laneName1, 0, 0,"#rentImg");
    addLane(laneName2, 25, 0, "#stadiumImg");
    addLane(laneName3, 50, 0,"#iconCustom");

    var rand = function(number) {
        return Math.ceil(Math.random() * number)
    }


    showPictograms(rand(45), laneName1);
    showPictograms(rand(45), laneName2);
    showPictograms(rand(45), laneName3);

    </script>

    <p>Based on <a href="http://bl.ocks.org/alansmithy/d832fc03f6e6a91e99f4">pictogram grid</a></p>

{% endblock %}